-- 채팅 메시지 저장 테이블 생성
CREATE TABLE IF NOT EXISTS CHAT_MESSAGES (
    MESSAGE_ID BIGINT AUTO_INCREMENT PRIMARY KEY,
    TRAVEL_PLAN_ID INT NOT NULL COMMENT '여행 계획 ID',
    SENDER_ID VARCHAR(50) NOT NULL COMMENT '발신자 ID',
    SENDER_NAME VARCHAR(100) NOT NULL COMMENT '발신자 이름',
    MESSAGE_CONTENT TEXT NOT NULL COMMENT '메시지 내용',
    MESSAGE_TYPE VARCHAR(20) DEFAULT 'CHAT' COMMENT '메시지 타입 (CHAT, JOIN, LEAVE, FILE, IMAGE)',
    SENT_TIME DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '전송 시간',
    FILE_NAME VARCHAR(255) NULL COMMENT '파일명 (파일/이미지 메시지인 경우)',
    FILE_PATH VARCHAR(500) NULL COMMENT '파일 경로 (파일/이미지 메시지인 경우)',
    FILE_SIZE VARCHAR(50) NULL COMMENT '파일 크기 (파일/이미지 메시지인 경우)',
    CONSTRAINT FK_CHAT_TRAVEL_PLAN FOREIGN KEY (TRAVEL_PLAN_ID) REFERENCES TRAVEL_PLAN(PLAN_ID) ON DELETE CASCADE,
    CONSTRAINT FK_CHAT_SENDER FOREIGN KEY (SENDER_ID) REFERENCES MEMBER(USER_ID) ON DELETE CASCADE
);

-- 인덱스 생성
CREATE INDEX IF NOT EXISTS IDX_CHAT_TRAVEL_PLAN ON CHAT_MESSAGES(TRAVEL_PLAN_ID);
CREATE INDEX IF NOT EXISTS IDX_CHAT_SENDER ON CHAT_MESSAGES(SENDER_ID);
CREATE INDEX IF NOT EXISTS IDX_CHAT_SENT_TIME ON CHAT_MESSAGES(SENT_TIME);

-- 샘플 데이터 (테스트용)
INSERT IGNORE INTO CHAT_MESSAGES (TRAVEL_PLAN_ID, SENDER_ID, SENDER_NAME, MESSAGE_CONTENT, MESSAGE_TYPE) VALUES
(1, 'testuser1', '테스트사용자1', '안녕하세요! 제주도 여행 기대됩니다.', 'CHAT'),
(1, 'testuser2', '테스트사용자2', '저도 함께 참여하고 싶어요!', 'CHAT'),
(1, 'admin', '관리자', '모두 환영합니다. 즐거운 여행 되세요!', 'CHAT');