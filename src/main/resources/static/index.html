<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="AI ê¸°ë°˜ ì—¬í–‰ íŠ¸ë Œë“œ ë¶„ì„ í”Œë«í¼ - ì‹¤ì‹œê°„ ì—¬í–‰ì§€ ì¶”ì²œ ë° ê°œì¸í™” ì„œë¹„ìŠ¤">
    <meta name="keywords" content="ì—¬í–‰, íŠ¸ë Œë“œ, AI, ì¶”ì²œ, ì—¬í–‰ì§€, ê´€ê´‘">
    <title>ì—¬í–‰ íŠ¸ë Œë“œ ë¶„ì„ í”Œë«í¼</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="/css/mobile-responsive.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- SockJS and STOMP for WebSocket -->
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@stomp/stompjs@6/bundles/stomp.umd.min.js"></script>
    
    <!-- Mobile Utils -->
    <script src="/js/mobile-utils.js"></script>
    
    <style>
        /* ì¶”ê°€ ìŠ¤íƒ€ì¼ */
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 0;
            text-align: center;
            margin-bottom: 40px;
        }
        
        .hero-title {
            font-size: 2.5rem;
            font-weight: bold;
            margin-bottom: 20px;
        }
        
        .hero-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 30px;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        
        .feature-card {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
        }
        
        .feature-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            color: #2196F3;
        }
        
        .notification-panel {
            position: fixed;
            top: 80px;
            right: 20px;
            width: 300px;
            max-height: 400px;
            overflow-y: auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            display: none;
        }
        
        .notification-header {
            padding: 15px 20px;
            border-bottom: 1px solid #e0e0e0;
            font-weight: 600;
            background: #f8f9fa;
            border-radius: 12px 12px 0 0;
        }
        
        .notification-item {
            padding: 15px 20px;
            border-bottom: 1px solid #f0f0f0;
            transition: background 0.2s ease;
        }
        
        .notification-item:hover {
            background: #f8f9fa;
        }
        
        .notification-item:last-child {
            border-bottom: none;
        }
        
        .notification-time {
            font-size: 0.8rem;
            color: #6c757d;
        }
        
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2rem;
            }
            
            .hero-subtitle {
                font-size: 1rem;
            }
            
            .feature-grid {
                grid-template-columns: 1fr;
            }
            
            .notification-panel {
                right: 10px;
                left: 10px;
                width: auto;
            }
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <nav class="navbar container">
            <div class="navbar-brand">ğŸŒŸ ì—¬í–‰ íŠ¸ë Œë“œ</div>
            
            <ul class="navbar-nav">
                <li class="nav-item"><a href="#home" class="nav-link">í™ˆ</a></li>
                <li class="nav-item"><a href="#trends" class="nav-link">íŠ¸ë Œë“œ ë¶„ì„</a></li>
                <li class="nav-item"><a href="#mbti-recommendations" class="nav-link">MBTI ì¶”ì²œ</a></li>
                <li class="nav-item"><a href="#seasonal-prediction" class="nav-link">ê³„ì ˆ ì˜ˆì¸¡</a></li>
                <li class="nav-item"><a href="#planning" class="nav-link">ì—¬í–‰ ê³„íš</a></li>
                <li class="nav-item">
                    <button id="notificationBtn" class="btn btn-primary">
                        ğŸ”” ì•Œë¦¼ <span id="notificationBadge" class="badge badge-danger" style="display: none;">0</span>
                    </button>
                </li>
            </ul>
            
            <div class="navbar-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </nav>
    </header>

    <!-- ì•Œë¦¼ íŒ¨ë„ -->
    <div id="notificationPanel" class="notification-panel">
        <div class="notification-header">
            ğŸ”” ì‹¤ì‹œê°„ ì•Œë¦¼
            <button id="closeNotifications" style="float: right; background: none; border: none; font-size: 1.2rem;">&times;</button>
        </div>
        <div id="notificationList">
            <div class="notification-item">
                <div>ì•Œë¦¼ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                <div class="notification-time">ì§€ê¸ˆ</div>
            </div>
        </div>
    </div>

    <!-- íˆì–´ë¡œ ì„¹ì…˜ -->
    <section id="home" class="hero-section">
        <div class="container">
            <h1 class="hero-title">AI ê¸°ë°˜ ì—¬í–‰ íŠ¸ë Œë“œ ë¶„ì„</h1>
            <p class="hero-subtitle">ì‹¤ì‹œê°„ ë°ì´í„°ë¡œ ê°€ì¥ ì¸ê¸° ìˆëŠ” ì—¬í–‰ì§€ë¥¼ ë°œê²¬í•˜ê³  ë§ì¶¤í˜• ì¶”ì²œì„ ë°›ì•„ë³´ì„¸ìš”</p>
            <button onclick="startAnalysis()" class="btn btn-success btn-lg">íŠ¸ë Œë“œ ë¶„ì„ ì‹œì‘</button>
        </div>
    </section>

    <!-- ì£¼ìš” ê¸°ëŠ¥ -->
    <section class="container">
        <div class="feature-grid">
            <div class="feature-card">
                <div class="feature-icon">ğŸ“ˆ</div>
                <h3>ì‹¤ì‹œê°„ íŠ¸ë Œë“œ ë¶„ì„</h3>
                <p>SNS, ê²€ìƒ‰ ë°ì´í„°ë¥¼ ê¸°ë°˜ìœ¼ë¡œ í•œ ì‹¤ì‹œê°„ ì—¬í–‰ì§€ ì¸ê¸°ë„ ë¶„ì„</p>
                <button onclick="showTrends()" class="btn btn-primary">íŠ¸ë Œë“œ ë³´ê¸°</button>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">ğŸ¯</div>
                <h3>MBTI ë§ì¶¤ ì¶”ì²œ</h3>
                <p>MBTI ì„±ê²© ìœ í˜•ë³„ ë² ìŠ¤íŠ¸ 3 ì—¬í–‰ íŠ¸ë Œë“œ ì¶”ì²œ</p>
                <button onclick="showMbtiRecommendations()" class="btn btn-primary">MBTI ì¶”ì²œ</button>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">ğŸŒ¤ï¸</div>
                <h3>ê³„ì ˆë³„ íŠ¸ë Œë“œ ì˜ˆì¸¡</h3>
                <p>8ì›” í˜„ì¬ ìƒìŠ¹ ì˜ˆì¸¡ ì—¬í–‰ì§€ ë¶„ì„</p>
                <button onclick="showSeasonalPrediction()" class="btn btn-primary">ê³„ì ˆ ì˜ˆì¸¡</button>
            </div>
            
            <div class="feature-card">
                <div class="feature-icon">ğŸ—ºï¸</div>
                <h3>ì—¬í–‰ ê³„íš ìµœì í™”</h3>
                <p>AI ê¸°ë°˜ ê²½ë¡œ ìµœì í™”ì™€ ì˜ˆì‚° ê´€ë¦¬</p>
                <button onclick="showPlanning()" class="btn btn-primary">ê³„íš ì„¸ìš°ê¸°</button>
            </div>
        </div>
    </section>

    <!-- íŠ¸ë Œë“œ ë¶„ì„ ì„¹ì…˜ -->
    <section id="trends" class="container" style="display: none;">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ğŸ“Š ì‹¤ì‹œê°„ íŠ¸ë Œë“œ ë¶„ì„</h2>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">MBTI ì„ íƒ (ì„ íƒì‚¬í•­)</label>
                            <select id="mbtiSelect" class="form-control">
                                <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="INTJ">INTJ - ê±´ì¶•ê°€</option>
                                <option value="INTP">INTP - ë…¼ë¦¬ìˆ ì‚¬</option>
                                <option value="ENTJ">ENTJ - í†µì†”ì</option>
                                <option value="ENTP">ENTP - ë³€ë¡ ê°€</option>
                                <option value="INFJ">INFJ - ì˜¹í˜¸ì</option>
                                <option value="INFP">INFP - ì¤‘ì¬ì</option>
                                <option value="ENFJ">ENFJ - ì„ ë„ì</option>
                                <option value="ENFP">ENFP - í™œë™ê°€</option>
                                <option value="ISTJ">ISTJ - ê´€ë¦¬ì</option>
                                <option value="ISFJ">ISFJ - ìˆ˜í˜¸ì</option>
                                <option value="ESTJ">ESTJ - ì‚¬ì—…ê°€</option>
                                <option value="ESFJ">ESFJ - ì§‘ì •ê´€</option>
                                <option value="ISTP">ISTP - ì œì‘ì</option>
                                <option value="ISFP">ISFP - ëª¨í—˜ê°€</option>
                                <option value="ESTP">ESTP - ì‚¬ì—…ê°€</option>
                                <option value="ESFP">ESFP - ì—°ì˜ˆì¸</option>
                            </select>
                        </div>
                        <button onclick="analyzeTrends()" class="btn btn-primary btn-block">íŠ¸ë Œë“œ ë¶„ì„</button>
                        <button id="reanalyzeBtn" onclick="showFeedbackModal()" class="btn btn-secondary btn-block mt-2" style="display: none;">ë‹¤ì‹œ ë¶„ì„í•˜ê¸°</button>
                    </div>
                    <div class="col-md-6">
                        <div id="trendLoadingIndicator" class="loading-spinner" style="display: none;"></div>
                        <div id="trendResults"></div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="chart-container">
                            <canvas id="trendChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ê°œì¸í™” ì¶”ì²œ ì„¹ì…˜ -->
    <section id="recommendations" class="container" style="display: none;">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ğŸ¯ ë§ì¶¤í˜• ì¶”ì²œ</h2>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">ì„ í˜¸í•˜ëŠ” ì—¬í–‰ ìŠ¤íƒ€ì¼</label>
                            <select id="travelStyle" class="form-control">
                                <option value="adventure">ëª¨í—˜/ì•¡í‹°ë¹„í‹°</option>
                                <option value="relaxation">íœ´ì‹/íë§</option>
                                <option value="culture">ë¬¸í™”/ì—­ì‚¬</option>
                                <option value="food">ë§›ì§‘/ë¯¸ì‹</option>
                                <option value="nature">ìì—°/í’ê²½</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ì„ í˜¸ í™œë™ (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</label>
                            <div>
                                <label><input type="checkbox" value="hiking"> í•˜ì´í‚¹</label><br>
                                <label><input type="checkbox" value="photography"> ì‚¬ì§„ì´¬ì˜</label><br>
                                <label><input type="checkbox" value="foodtour"> ë§›ì§‘íˆ¬ì–´</label><br>
                                <label><input type="checkbox" value="shopping"> ì‡¼í•‘</label><br>
                                <label><input type="checkbox" value="culture"> ë¬¸í™”ì²´í—˜</label>
                            </div>
                        </div>
                        
                        <button onclick="getPersonalizedRecommendations()" class="btn btn-success btn-block">ë§ì¶¤ ì¶”ì²œ ë°›ê¸°</button>
                    </div>
                    <div class="col-md-6">
                        <div id="recommendationResults"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ì—¬í–‰ ê³„íš ì„¹ì…˜ -->
    <section id="planning" class="container" style="display: none;">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ğŸ—ºï¸ AI ì—¬í–‰ ê³„íš</h2>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">ëª©ì ì§€</label>
                            <input type="text" id="destination" class="form-control" placeholder="ì˜ˆ: ì œì£¼ë„">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ì—¬í–‰ ê¸°ê°„ (ì¼)</label>
                            <input type="number" id="duration" class="form-control" value="3" min="1" max="30">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ì˜ˆì‚° (ì›)</label>
                            <input type="number" id="budget" class="form-control" placeholder="500000" step="10000">
                        </div>
                        
                        <button onclick="createTravelPlan()" class="btn btn-warning btn-block">AI ê³„íš ìƒì„±</button>
                    </div>
                    <div class="col-md-6">
                        <div id="planningResults"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- í”¼ë“œë°± ëª¨ë‹¬ -->
    <div id="feedbackModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>ğŸ”„ ë¶„ì„ ê²°ê³¼ ê°œì„ í•˜ê¸°</h3>
                <button onclick="closeFeedbackModal()" class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <p><strong>í˜„ì¬ ì¶”ì²œ ê²°ê³¼ì— ëŒ€í•´ ì–´ë–¤ ì ì´ ì•„ì‰¬ìš°ì‹ ê°€ìš”?</strong></p>
                
                <div class="feedback-section">
                    <h4>ğŸ¯ ì¶”ì²œ ì—¬í–‰ì§€ ê´€ë ¨</h4>
                    <div class="feedback-options">
                        <label><input type="checkbox" name="feedback" value="too-crowded"> ë„ˆë¬´ ìœ ëª…í•´ì„œ ì‚¬ëŒì´ ë§ì„ ê²ƒ ê°™ì•„ìš”</label>
                        <label><input type="checkbox" name="feedback" value="too-expensive"> ì˜ˆì‚°ì´ ë¶€ì¡±í•  ê²ƒ ê°™ì•„ìš”</label>
                        <label><input type="checkbox" name="feedback" value="not-interesting"> í¥ë¯¸ë¡­ì§€ ì•Šì•„ìš”</label>
                        <label><input type="checkbox" name="feedback" value="been-there"> ì´ë¯¸ ê°€ë³¸ ê³³ì´ì—ìš”</label>
                        <label><input type="checkbox" name="feedback" value="too-far"> ë„ˆë¬´ ë©€ì–´ìš”</label>
                    </div>
                </div>
                
                <div class="feedback-section">
                    <h4>ğŸŒŸ ì›í•˜ëŠ” ì—¬í–‰ íŠ¹ì„±</h4>
                    <div class="feedback-options">
                        <label><input type="checkbox" name="preference" value="hidden-gems"> ìˆ¨ê²¨ì§„ ëª…ì†Œë¥¼ ì°¾ê³  ì‹¶ì–´ìš”</label>
                        <label><input type="checkbox" name="preference" value="budget-friendly"> ì €ë ´í•œ ì—¬í–‰ì§€ë¥¼ ì›í•´ìš”</label>
                        <label><input type="checkbox" name="preference" value="unique-experience"> ë…íŠ¹í•œ ê²½í—˜ì„ í•˜ê³  ì‹¶ì–´ìš”</label>
                        <label><input type="checkbox" name="preference" value="peaceful"> ì¡°ìš©í•˜ê³  í‰í™”ë¡œìš´ ê³³ì„ ì›í•´ìš”</label>
                        <label><input type="checkbox" name="preference" value="adventure"> ëª¨í—˜ì ì¸ í™œë™ì„ í•˜ê³  ì‹¶ì–´ìš”</label>
                        <label><input type="checkbox" name="preference" value="cultural"> ë¬¸í™”ì  ì²´í—˜ì„ ì¤‘ì‹œí•´ìš”</label>
                    </div>
                </div>
                
                <div class="feedback-section">
                    <h4>ğŸ“ ì¶”ê°€ ìš”ì²­ì‚¬í•­</h4>
                    <textarea id="additionalFeedback" placeholder="êµ¬ì²´ì ì¸ ìš”ì²­ì‚¬í•­ì´ë‚˜ ì„ í˜¸ë„ë¥¼ ììœ ë¡­ê²Œ ì ì–´ì£¼ì„¸ìš”..." rows="3"></textarea>
                </div>
                
                <div class="feedback-section">
                    <h4>ğŸ—“ï¸ ì—¬í–‰ ì‹œê¸°</h4>
                    <select id="travelSeason">
                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        <option value="spring">ë´„ (3-5ì›”)</option>
                        <option value="summer">ì—¬ë¦„ (6-8ì›”)</option>
                        <option value="autumn">ê°€ì„ (9-11ì›”)</option>
                        <option value="winter">ê²¨ìš¸ (12-2ì›”)</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="submitFeedbackAndReanalyze()" class="btn btn-primary">ğŸ” ê°œì„ ëœ ë¶„ì„ ë°›ê¸°</button>
                <button onclick="closeFeedbackModal()" class="btn btn-secondary">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- í‘¸í„° -->
    <footer style="background: #333; color: white; text-align: center; padding: 40px 0; margin-top: 60px;">
        <div class="container">
            <p>&copy; 2024 ì—¬í–‰ íŠ¸ë Œë“œ ë¶„ì„ í”Œë«í¼. All rights reserved.</p>
            <p>AI ê¸°ë°˜ ì‹¤ì‹œê°„ ì—¬í–‰ íŠ¸ë Œë“œ ë¶„ì„ ì„œë¹„ìŠ¤</p>
        </div>
    </footer>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let stompClient = null;
        let notificationCount = 0;
        let currentChart = null;

        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ í›„ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            connectWebSocket();
            setupEventListeners();
            
            // ëª¨ë°”ì¼ ìµœì í™” í™•ì¸
            if (window.mobileUtils && window.mobileUtils.isMobile) {
                optimizeForMobile();
            }
        });

        // WebSocket ì—°ê²°
        function connectWebSocket() {
            const socket = new SockJS('/ws');
            stompClient = Stomp.over(socket);
            
            stompClient.connect({}, function (frame) {
                console.log('WebSocket ì—°ê²°ë¨: ' + frame);
                
                // ì „ì²´ ì•Œë¦¼ êµ¬ë…
                stompClient.subscribe('/topic/alerts', function (message) {
                    const alert = JSON.parse(message.body);
                    showNotification(alert);
                });
                
                // SNS ì•Œë¦¼ êµ¬ë…
                stompClient.subscribe('/topic/sns-alerts', function (message) {
                    const alert = JSON.parse(message.body);
                    showNotification(alert);
                });
            });
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
        function setupEventListeners() {
            // ì•Œë¦¼ ë²„íŠ¼
            document.getElementById('notificationBtn').addEventListener('click', toggleNotificationPanel);
            document.getElementById('closeNotifications').addEventListener('click', hideNotificationPanel);
            
            // ë„¤ë¹„ê²Œì´ì…˜
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);
                    showSection(targetId);
                });
            });
        }

        // ì„¹ì…˜ í‘œì‹œ
        function showSection(sectionId) {
            // ëª¨ë“  ì„¹ì…˜ ìˆ¨ê¸°ê¸°
            document.querySelectorAll('section[id]').forEach(section => {
                if (section.id !== 'home') {
                    section.style.display = 'none';
                }
            });
            
            // ì„ íƒëœ ì„¹ì…˜ í‘œì‹œ
            if (sectionId !== 'home') {
                const section = document.getElementById(sectionId);
                if (section) {
                    section.style.display = 'block';
                    
                    // ìŠ¤í¬ë¡¤
                    if (window.mobileUtils) {
                        window.mobileUtils.smoothScrollTo(section);
                    } else {
                        section.scrollIntoView({ behavior: 'smooth' });
                    }
                }
            }
        }

        // íŠ¸ë Œë“œ ë¶„ì„ ì‹œì‘
        function startAnalysis() {
            showSection('trends');
        }

        // íŠ¸ë Œë“œ ë³´ê¸°
        function showTrends() {
            showSection('trends');
        }

        // ì¶”ì²œ ë³´ê¸°
        function showRecommendations() {
            showSection('recommendations');
        }

        // ê³„íš ë³´ê¸°
        function showPlanning() {
            showSection('planning');
        }

        // íŠ¸ë Œë“œ ë¶„ì„ ì‹¤í–‰
        async function analyzeTrends() {
            const loadingIndicator = document.getElementById('trendLoadingIndicator');
            const resultsDiv = document.getElementById('trendResults');
            const mbti = document.getElementById('mbtiSelect').value;
            
            loadingIndicator.style.display = 'block';
            resultsDiv.innerHTML = '';
            
            try {
                const requestBody = {
                    analysisType: 'COMPREHENSIVE',
                    includePersonalized: true
                };
                
                // MBTIê°€ ì„ íƒëœ ê²½ìš° ì¶”ê°€
                if (mbti && mbti !== '') {
                    requestBody.mbti = mbti;
                }
                
                const response = await fetch('/api/social-trends/analyze', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                });
                
                const data = await response.json();
                
                loadingIndicator.style.display = 'none';
                
                if (data.status === 'success') {
                    displayTrendResults(data.analysis);
                    createTrendChart(data.analysis);
                } else {
                    resultsDiv.innerHTML = `<div class="alert alert-danger">${data.message}</div>`;
                }
                
            } catch (error) {
                loadingIndicator.style.display = 'none';
                resultsDiv.innerHTML = '<div class="alert alert-danger">íŠ¸ë Œë“œ ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
                console.error('Error:', error);
            }
        }

        // íŠ¸ë Œë“œ ê²°ê³¼ í‘œì‹œ
        function displayTrendResults(analysis) {
            const resultsDiv = document.getElementById('trendResults');
            
            let html = '<h4>ğŸ”¥ ì¸ê¸° ê¸‰ìƒìŠ¹ ì—¬í–‰ì§€</h4>';
            
            if (analysis.popularDestinations && analysis.popularDestinations.length > 0) {
                html += '<div class="mb-3">';
                analysis.popularDestinations.slice(0, 3).forEach(dest => {
                    html += `
                        <div class="alert alert-info">
                            <strong>${dest.destinationName}</strong> 
                            <span class="badge badge-primary">${dest.trendScore}</span>
                            <br>
                            <small>${dest.description}</small>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            if (analysis.trendingKeywords && analysis.trendingKeywords.length > 0) {
                html += '<h5>ğŸ“ˆ íŠ¸ë Œë”© í‚¤ì›Œë“œ</h5>';
                html += '<div>';
                analysis.trendingKeywords.slice(0, 5).forEach(keyword => {
                    html += `<span class="badge badge-secondary mr-2">${keyword.keyword}</span>`;
                });
                html += '</div>';
            }
            
            // MBTI ê¸°ë°˜ ë§ì¶¤ ì¶”ì²œ í‘œì‹œ
            if (analysis.mbtiRecommendations && analysis.mbtiRecommendations.length > 0) {
                html += '<div class="mt-4">';
                html += '<h5>ğŸ¯ MBTI ë§ì¶¤ ì¶”ì²œ</h5>';
                analysis.mbtiRecommendations.forEach(rec => {
                    html += `
                        <div class="card mb-2">
                            <div class="card-body">
                                <h6 class="card-title">${rec.destinationName}</h6>
                                <p class="card-text">${rec.reason}</p>
                                <small class="text-muted">ì¶”ì²œë„: ${rec.score}/10</small>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // ê°œì¸í™” ì¶”ì²œ í‘œì‹œ
            if (analysis.personalizedRecommendations && analysis.personalizedRecommendations.length > 0) {
                html += '<div class="mt-4">';
                html += '<h5>âœ¨ ê°œì¸í™” ì¶”ì²œ</h5>';
                analysis.personalizedRecommendations.forEach(rec => {
                    html += `
                        <div class="card mb-2">
                            <div class="card-body">
                                <h6 class="card-title">${rec.destinationName}</h6>
                                <p class="card-text">${rec.reason}</p>
                                <small class="text-muted">ë§ì¶¤ë„: ${rec.score}/10</small>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            // MBTIë‚˜ ê°œì¸í™” ì¶”ì²œì´ ì—†ëŠ” ê²½ìš° ì•ˆë‚´ ë©”ì‹œì§€
            if ((!analysis.mbtiRecommendations || analysis.mbtiRecommendations.length === 0) && 
                (!analysis.personalizedRecommendations || analysis.personalizedRecommendations.length === 0)) {
                html += `
                    <div class="mt-4">
                        <div class="alert alert-warning">
                            <h6>ğŸ¯ ë§ì¶¤ ì¶”ì²œì„ ë°›ìœ¼ë ¤ë©´</h6>
                            <p class="mb-2">ë” ì •í™•í•œ ë§ì¶¤ ì¶”ì²œì„ ë°›ìœ¼ì‹œë ¤ë©´ ì•„ë˜ ì •ë³´ë¥¼ ì œê³µí•´ì£¼ì„¸ìš”:</p>
                            <ul class="mb-2">
                                <li>MBTI ì„ íƒ í›„ ë¶„ì„</li>
                                <li>ê°œë³„ MBTI ë§ì¶¤ ì¶”ì²œ ì„¹ì…˜ ì´ìš©</li>
                            </ul>
                            <button class="btn btn-sm btn-outline-primary" onclick="showSection('mbti-recommendation')">
                                MBTI ë§ì¶¤ ì¶”ì²œ ë°›ê¸°
                            </button>
                        </div>
                    </div>
                `;
            }
            
            resultsDiv.innerHTML = html;
            
            // ë‹¤ì‹œ ë¶„ì„ ë²„íŠ¼ í‘œì‹œ
            document.getElementById('reanalyzeBtn').style.display = 'block';
        }

        // íŠ¸ë Œë“œ ì°¨íŠ¸ ìƒì„±
        function createTrendChart(analysis) {
            const ctx = document.getElementById('trendChart').getContext('2d');
            
            if (currentChart) {
                currentChart.destroy();
            }
            
            const destinations = analysis.popularDestinations || [];
            const labels = destinations.slice(0, 5).map(d => d.destinationName);
            const scores = destinations.slice(0, 5).map(d => d.trendScore);
            
            const isMobile = window.mobileUtils ? window.mobileUtils.isMobile : false;
            
            currentChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'íŠ¸ë Œë“œ ì ìˆ˜',
                        data: scores,
                        backgroundColor: 'rgba(33, 150, 243, 0.6)',
                        borderColor: 'rgba(33, 150, 243, 1)',
                        borderWidth: 2
                    }]
                },
                options: window.ResponsiveChartHelper ? 
                    window.ResponsiveChartHelper.getResponsiveOptions(isMobile) : 
                    {
                        responsive: true,
                        maintainAspectRatio: false
                    }
            });
        }

        // ê°œì¸í™” ì¶”ì²œ
        async function getPersonalizedRecommendations() {
            const resultsDiv = document.getElementById('recommendationResults');
            const travelStyle = document.getElementById('travelStyle').value;
            const activities = Array.from(document.querySelectorAll('#recommendations input[type="checkbox"]:checked'))
                                   .map(cb => cb.value);
            
            resultsDiv.innerHTML = '<div class="loading-spinner"></div>';
            
            try {
                const response = await fetch('/api/user-preference/record-interaction', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        interactionType: 'recommendation_request',
                        data: {
                            travelStyle: travelStyle,
                            preferredActivities: activities
                        }
                    })
                });
                
                const data = await response.json();
                
                let html = '<h4>ğŸ¯ ë§ì¶¤ ì¶”ì²œ ê²°ê³¼</h4>';
                html += `<div class="alert alert-success">
                    <strong>ì¶”ì²œ ì™„ë£Œ!</strong><br>
                    ì—¬í–‰ ìŠ¤íƒ€ì¼: ${travelStyle}<br>
                    ì„ í˜¸ í™œë™: ${activities.join(', ')}
                </div>`;
                
                // ì¶”ì²œ ê²°ê³¼ (ì‹¤ì œë¡œëŠ” AI ë¶„ì„ ê²°ê³¼)
                html += `
                    <div class="card mt-3">
                        <div class="card-body">
                            <h5>ì¶”ì²œ ì—¬í–‰ì§€</h5>
                            <p>ë‹¹ì‹ ì˜ ì„ í˜¸ë„ì— ë§ëŠ” ì—¬í–‰ì§€ë¥¼ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.</p>
                            <button onclick="getDetailedRecommendations()" class="btn btn-primary">ìƒì„¸ ì¶”ì²œ ë³´ê¸°</button>
                        </div>
                    </div>
                `;
                
                resultsDiv.innerHTML = html;
                
            } catch (error) {
                resultsDiv.innerHTML = '<div class="alert alert-danger">ì¶”ì²œ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
                console.error('Error:', error);
            }
        }

        // ì—¬í–‰ ê³„íš ìƒì„±
        async function createTravelPlan() {
            const resultsDiv = document.getElementById('planningResults');
            const destination = document.getElementById('destination').value;
            const duration = document.getElementById('duration').value;
            const budget = document.getElementById('budget').value;
            
            if (!destination) {
                if (window.mobileUtils) {
                    window.mobileUtils.showToast('ëª©ì ì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
                } else {
                    alert('ëª©ì ì§€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                }
                return;
            }
            
            resultsDiv.innerHTML = '<div class="loading-spinner"></div>';
            
            try {
                const response = await fetch('/api/travel-plan-integration/comprehensive-recommendation', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        destination: destination,
                        days: parseInt(duration),
                        budget: budget ? parseInt(budget) : null
                    })
                });
                
                const data = await response.json();
                
                let html = '<h4>ğŸ—ºï¸ AI ì—¬í–‰ ê³„íš</h4>';
                html += `
                    <div class="alert alert-info">
                        <strong>ëª©ì ì§€:</strong> ${destination}<br>
                        <strong>ê¸°ê°„:</strong> ${duration}ì¼<br>
                        ${budget ? `<strong>ì˜ˆì‚°:</strong> ${parseInt(budget).toLocaleString()}ì›<br>` : ''}
                    </div>
                `;
                
                if (data.optimizedPlan) {
                    html += `
                        <div class="card">
                            <div class="card-header">ìµœì í™”ëœ ê³„íš</div>
                            <div class="card-body">
                                <p>íŠ¸ë Œë“œ ë¶„ì„ì„ ê¸°ë°˜ìœ¼ë¡œ í•œ ë§ì¶¤í˜• ì—¬í–‰ ê³„íšì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
                                <button onclick="showDetailedPlan()" class="btn btn-success">ìƒì„¸ ê³„íš ë³´ê¸°</button>
                            </div>
                        </div>
                    `;
                }
                
                resultsDiv.innerHTML = html;
                
                if (window.mobileUtils) {
                    window.mobileUtils.showToast('ì—¬í–‰ ê³„íšì´ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                }
                
            } catch (error) {
                resultsDiv.innerHTML = '<div class="alert alert-danger">ì—¬í–‰ ê³„íš ìƒì„± ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
                console.error('Error:', error);
            }
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showNotification(alert) {
            notificationCount++;
            updateNotificationBadge();
            
            // ì•Œë¦¼ ë¦¬ìŠ¤íŠ¸ì— ì¶”ê°€
            const notificationList = document.getElementById('notificationList');
            const notificationItem = document.createElement('div');
            notificationItem.className = 'notification-item';
            notificationItem.innerHTML = `
                <div><strong>${alert.type}:</strong> ${alert.message || alert.destinationName}</div>
                <div class="notification-time">${new Date().toLocaleTimeString()}</div>
            `;
            
            notificationList.insertBefore(notificationItem, notificationList.firstChild);
            
            // í† ìŠ¤íŠ¸ ì•Œë¦¼ (ëª¨ë°”ì¼ì—ì„œ)
            if (window.mobileUtils) {
                const message = alert.message || `${alert.destinationName}ì´(ê°€) ê¸‰ìƒìŠ¹ ì¤‘ì…ë‹ˆë‹¤!`;
                window.mobileUtils.showToast(message, 'info', 5000);
                
                // ì§„ë™ í”¼ë“œë°±
                window.mobileUtils.vibrate([100, 50, 100]);
            }
        }

        // ì•Œë¦¼ ë°°ì§€ ì—…ë°ì´íŠ¸
        function updateNotificationBadge() {
            const badge = document.getElementById('notificationBadge');
            if (notificationCount > 0) {
                badge.textContent = notificationCount;
                badge.style.display = 'inline';
            } else {
                badge.style.display = 'none';
            }
        }

        // ì•Œë¦¼ íŒ¨ë„ í† ê¸€
        function toggleNotificationPanel() {
            const panel = document.getElementById('notificationPanel');
            if (panel.style.display === 'none' || panel.style.display === '') {
                panel.style.display = 'block';
                notificationCount = 0;
                updateNotificationBadge();
            } else {
                panel.style.display = 'none';
            }
        }

        // ì•Œë¦¼ íŒ¨ë„ ìˆ¨ê¸°ê¸°
        function hideNotificationPanel() {
            document.getElementById('notificationPanel').style.display = 'none';
        }

        // ëª¨ë°”ì¼ ìµœì í™”
        function optimizeForMobile() {
            // ì°¨íŠ¸ í¬ê¸° ì¡°ì •
            const chartContainers = document.querySelectorAll('.chart-container');
            chartContainers.forEach(container => {
                container.style.height = '250px';
            });
            
            // ë²„íŠ¼ í¬ê¸° ì¡°ì •
            const buttons = document.querySelectorAll('.btn');
            buttons.forEach(btn => {
                if (!btn.classList.contains('btn-lg')) {
                    btn.style.width = '100%';
                    btn.style.marginBottom = '10px';
                }
            });
        }

        // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ì´ë²¤íŠ¸
        window.addEventListener('resize', function() {
            if (currentChart) {
                currentChart.resize();
            }
        });

        // ì¶”ê°€ í•¨ìˆ˜ë“¤ (ì‹¤ì œ êµ¬í˜„ ì‹œ í™•ì¥)
        function getDetailedRecommendations() {
            if (window.mobileUtils) {
                window.mobileUtils.showToast('ìƒì„¸ ì¶”ì²œ ê¸°ëŠ¥ì„ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.', 'info');
            }
        }

        function showDetailedPlan() {
            if (window.mobileUtils) {
                window.mobileUtils.showToast('ìƒì„¸ ê³„íš ê¸°ëŠ¥ì„ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.', 'info');
            }
        }

        // í”¼ë“œë°± ëª¨ë‹¬ ê´€ë ¨ í•¨ìˆ˜ë“¤
        function showFeedbackModal() {
            document.getElementById('feedbackModal').style.display = 'block';
            document.body.style.overflow = 'hidden'; // ë°°ê²½ ìŠ¤í¬ë¡¤ ë°©ì§€
        }

        function closeFeedbackModal() {
            document.getElementById('feedbackModal').style.display = 'none';
            document.body.style.overflow = 'auto';
            
            // í¼ ì´ˆê¸°í™”
            document.querySelectorAll('#feedbackModal input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.getElementById('additionalFeedback').value = '';
            document.getElementById('travelSeason').value = '';
        }

        // í”¼ë“œë°± ê¸°ë°˜ ì¬ë¶„ì„
        async function submitFeedbackAndReanalyze() {
            const feedback = Array.from(document.querySelectorAll('#feedbackModal input[name="feedback"]:checked'))
                                 .map(cb => cb.value);
            
            const preferences = Array.from(document.querySelectorAll('#feedbackModal input[name="preference"]:checked'))
                                    .map(cb => cb.value);
            
            const additionalFeedback = document.getElementById('additionalFeedback').value;
            const travelSeason = document.getElementById('travelSeason').value;
            const mbti = document.getElementById('mbtiSelect').value;

            // ëª¨ë‹¬ ë‹«ê¸°
            closeFeedbackModal();

            // ë¡œë”© í‘œì‹œ
            const loadingIndicator = document.getElementById('trendLoadingIndicator');
            const resultsDiv = document.getElementById('trendResults');
            
            loadingIndicator.style.display = 'block';
            resultsDiv.innerHTML = '<div class="alert alert-info">ğŸ”„ í”¼ë“œë°±ì„ ë°˜ì˜í•˜ì—¬ ìƒˆë¡œìš´ íŠ¸ë Œë“œë¥¼ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</div>';

            try {
                // ì‚¬ìš©ì í”¼ë“œë°± ê¸°ë¡
                await recordUserFeedback(feedback, preferences, additionalFeedback, travelSeason);

                // ê°œì„ ëœ ë¶„ì„ ìš”ì²­
                const response = await fetch('/api/social-trends/analyze-with-feedback', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        mbti: mbti,
                        previousFeedback: feedback,
                        preferences: preferences,
                        additionalRequests: additionalFeedback,
                        season: travelSeason,
                        excludeMainstream: feedback.includes('too-crowded'),
                        budgetConscious: preferences.includes('budget-friendly'),
                        seekingHiddenGems: preferences.includes('hidden-gems')
                    })
                });

                const data = await response.json();
                
                loadingIndicator.style.display = 'none';
                
                if (data.status === 'success') {
                    displayImprovedTrendResults(data.analysis, feedback, preferences);
                    createTrendChart(data.analysis);
                    
                    if (window.mobileUtils) {
                        window.mobileUtils.showToast('ğŸ¯ ê°œì„ ëœ ì¶”ì²œ ê²°ê³¼ë¥¼ í™•ì¸í•´ë³´ì„¸ìš”!', 'success', 4000);
                    }
                } else {
                    resultsDiv.innerHTML = `<div class="alert alert-danger">${data.message}</div>`;
                }
                
            } catch (error) {
                loadingIndicator.style.display = 'none';
                resultsDiv.innerHTML = '<div class="alert alert-danger">ê°œì„ ëœ ë¶„ì„ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
                console.error('Error:', error);
            }
        }

        // ê°œì„ ëœ íŠ¸ë Œë“œ ê²°ê³¼ í‘œì‹œ
        function displayImprovedTrendResults(analysis, feedback, preferences) {
            const resultsDiv = document.getElementById('trendResults');
            
            let html = '<div class="alert alert-success"><strong>âœ¨ í”¼ë“œë°±ì„ ë°˜ì˜í•œ ê°œì„ ëœ ì¶”ì²œ</strong></div>';
            
            // í”¼ë“œë°± ìš”ì•½ í‘œì‹œ
            if (feedback.length > 0 || preferences.length > 0) {
                html += '<div class="mb-3"><h5>ğŸ¯ ë°˜ì˜ëœ ì„ í˜¸ë„</h5><div class="feedback-summary">';
                
                if (feedback.includes('too-crowded')) html += '<span class="badge badge-info">ëœ ë¶ë¹„ëŠ” ê³³</span> ';
                if (feedback.includes('too-expensive')) html += '<span class="badge badge-info">í•©ë¦¬ì  ê°€ê²©</span> ';
                if (preferences.includes('hidden-gems')) html += '<span class="badge badge-success">ìˆ¨ê²¨ì§„ ëª…ì†Œ</span> ';
                if (preferences.includes('budget-friendly')) html += '<span class="badge badge-success">ì €ë ´í•œ ì—¬í–‰</span> ';
                if (preferences.includes('peaceful')) html += '<span class="badge badge-success">ì¡°ìš©í•œ ê³³</span> ';
                if (preferences.includes('adventure')) html += '<span class="badge badge-success">ëª¨í—˜ì </span> ';
                if (preferences.includes('cultural')) html += '<span class="badge badge-success">ë¬¸í™”ì </span> ';
                
                html += '</div></div>';
            }
            
            html += '<h4>ğŸŒŸ ë§ì¶¤í˜• ì¶”ì²œ ì—¬í–‰ì§€</h4>';
            
            if (analysis.popularDestinations && analysis.popularDestinations.length > 0) {
                html += '<div class="mb-3">';
                analysis.popularDestinations.slice(0, 3).forEach((dest, index) => {
                    const badgeClass = index === 0 ? 'badge-success' : index === 1 ? 'badge-primary' : 'badge-secondary';
                    const icon = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : 'ğŸ¥‰';
                    
                    html += `
                        <div class="alert alert-light border">
                            <div class="d-flex justify-content-between align-items-start">
                                <div>
                                    <h6>${icon} <strong>${dest.destinationName}</strong> 
                                        <span class="badge ${badgeClass}">${dest.trendScore}</span>
                                    </h6>
                                    <p class="mb-1">${dest.description}</p>
                                    <small class="text-muted">ê°œì„  ì´ìœ : ${getImprovementReason(dest, feedback, preferences)}</small>
                                </div>
                            </div>
                        </div>
                    `;
                });
                html += '</div>';
            }
            
            if (analysis.trendingKeywords && analysis.trendingKeywords.length > 0) {
                html += '<h5>ğŸ”¥ ë§ì¶¤ íŠ¸ë Œë“œ í‚¤ì›Œë“œ</h5>';
                html += '<div class="mb-3">';
                analysis.trendingKeywords.slice(0, 5).forEach(keyword => {
                    html += `<span class="badge badge-warning mr-2">${keyword.keyword}</span>`;
                });
                html += '</div>';
            }
            
            // ì¶”ê°€ ì•¡ì…˜ ë²„íŠ¼ë“¤
            html += `
                <div class="mt-3">
                    <button onclick="getDetailedRecommendations()" class="btn btn-outline-primary btn-sm">ìƒì„¸ ì •ë³´ ë³´ê¸°</button>
                    <button onclick="showFeedbackModal()" class="btn btn-outline-secondary btn-sm">ë‹¤ì‹œ ê°œì„ í•˜ê¸°</button>
                </div>
            `;
            
            resultsDiv.innerHTML = html;
        }

        // ê°œì„  ì´ìœ  ìƒì„±
        function getImprovementReason(dest, feedback, preferences) {
            const reasons = [];
            
            if (feedback.includes('too-crowded')) reasons.push('ëœ ë¶ë¹„ëŠ” ê´€ê´‘ì§€');
            if (feedback.includes('too-expensive')) reasons.push('í•©ë¦¬ì ì¸ ì—¬í–‰ ë¹„ìš©');
            if (preferences.includes('hidden-gems')) reasons.push('ìˆ¨ê²¨ì§„ ë³´ì„ê°™ì€ ëª…ì†Œ');
            if (preferences.includes('budget-friendly')) reasons.push('ì˜ˆì‚° ì¹œí™”ì ');
            if (preferences.includes('peaceful')) reasons.push('í‰í™”ë¡­ê³  ì¡°ìš©í•œ ë¶„ìœ„ê¸°');
            if (preferences.includes('adventure')) reasons.push('ëª¨í—˜ì  ì•¡í‹°ë¹„í‹° ê°€ëŠ¥');
            if (preferences.includes('cultural')) reasons.push('í’ë¶€í•œ ë¬¸í™” ì²´í—˜');
            
            return reasons.length > 0 ? reasons.join(', ') : 'íŠ¸ë Œë“œ ê¸°ë°˜ ê°œì¸í™” ì¶”ì²œ';
        }

        // ì‚¬ìš©ì í”¼ë“œë°± ê¸°ë¡
        async function recordUserFeedback(feedback, preferences, additionalFeedback, season) {
            try {
                await fetch('/api/user-preference/record-interaction', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        interactionType: 'trend_feedback',
                        data: {
                            negativeFeedback: feedback,
                            positivePreferences: preferences,
                            additionalRequests: additionalFeedback,
                            preferredSeason: season,
                            timestamp: new Date().toISOString()
                        }
                    })
                });
            } catch (error) {
                console.error('í”¼ë“œë°± ê¸°ë¡ ì‹¤íŒ¨:', error);
            }
        }

        // MBTI ì¶”ì²œ ì„¹ì…˜ í‘œì‹œ
        function showMbtiRecommendations() {
            showSection('mbti-recommendations');
        }

        // ê³„ì ˆë³„ ì˜ˆì¸¡ ì„¹ì…˜ í‘œì‹œ
        function showSeasonalPrediction() {
            showSection('seasonal-prediction');
        }

        // MBTI ê¸°ë°˜ ë§ì¶¤ ì¶”ì²œ ì‹¤í–‰
        async function getMbtiRecommendations() {
            const mbti = document.getElementById('mbtiSelectForRecommendation').value;
            const season = document.getElementById('seasonSelect').value;
            const budget = document.getElementById('budgetSelect').value;
            
            const interests = Array.from(document.querySelectorAll('input[name="interests"]:checked'))
                                 .map(cb => cb.value);

            if (!mbti) {
                alert('MBTIë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const loadingIndicator = document.getElementById('mbtiLoadingIndicator');
            const resultsDiv = document.getElementById('mbtiResults');
            
            loadingIndicator.style.display = 'block';
            resultsDiv.innerHTML = '<div class="alert alert-info">ğŸ¯ MBTI ê¸°ë°˜ ë§ì¶¤ ì¶”ì²œì„ ë¶„ì„ ì¤‘ì…ë‹ˆë‹¤...</div>';

            try {
                const response = await fetch('/api/mbti-recommendation/personalized', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        mbti: mbti,
                        season: season,
                        budgetLevel: budget,
                        travelStyle: 'ììœ ì—¬í–‰',
                        interests: interests
                    })
                });

                const data = await response.json();
                
                loadingIndicator.style.display = 'none';
                
                if (data.status === 'success') {
                    displayMbtiRecommendations(data);
                    
                    if (window.mobileUtils) {
                        window.mobileUtils.showToast('ğŸ¯ MBTI ë§ì¶¤ ì¶”ì²œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success', 4000);
                    }
                } else {
                    resultsDiv.innerHTML = `<div class="alert alert-danger">${data.message}</div>`;
                }
                
            } catch (error) {
                loadingIndicator.style.display = 'none';
                resultsDiv.innerHTML = '<div class="alert alert-danger">MBTI ì¶”ì²œ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
                console.error('Error:', error);
            }
        }

        // MBTI ì¶”ì²œ ê²°ê³¼ í‘œì‹œ
        function displayMbtiRecommendations(data) {
            const resultsDiv = document.getElementById('mbtiResults');
            const recommendations = data.recommendations;
            
            let html = `
                <div class="alert alert-success">
                    <strong>ğŸ¯ ${data.mbti} ë§ì¶¤ ì¶”ì²œ ì™„ë£Œ</strong>
                    <div class="mt-2">ê°œì¸í™” ì ìˆ˜: <span class="badge badge-primary">${data.personalizedScore}/10</span></div>
                </div>
            `;

            // MBTI í”„ë¡œí•„ í‘œì‹œ
            if (recommendations.mbtiProfile) {
                const profile = recommendations.mbtiProfile;
                html += `
                    <div class="card mb-3">
                        <div class="card-header">
                            <h5>ğŸ§  ${profile.type} ì—¬í–‰ ì„±í–¥ ë¶„ì„</h5>
                        </div>
                        <div class="card-body">
                            <p><strong>ì—¬í–‰ ì„±í–¥:</strong> ${profile.travelPersonality}</p>
                            <p><strong>ì„ í˜¸ ìŠ¤íƒ€ì¼:</strong> ${profile.preferredStyle}</p>
                            <div><strong>ì£¼ìš” ë™ê¸°:</strong></div>
                            <ul>
                                ${profile.motivations.map(motivation => `<li>${motivation}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                `;
            }

            // TOP 3 ì¶”ì²œ í‘œì‹œ
            if (recommendations.topRecommendations) {
                html += '<h4>ğŸŒŸ ë² ìŠ¤íŠ¸ 3 ì¶”ì²œ</h4>';
                
                recommendations.topRecommendations.forEach((rec, index) => {
                    const rankIcon = index === 0 ? 'ğŸ¥‡' : index === 1 ? 'ğŸ¥ˆ' : 'ğŸ¥‰';
                    const badgeClass = index === 0 ? 'badge-success' : index === 1 ? 'badge-primary' : 'badge-warning';
                    
                    html += `
                        <div class="card mb-3">
                            <div class="card-header">
                                <h6>${rankIcon} ${rec.rank}ìœ„. ${rec.trendName}</h6>
                                <span class="badge ${badgeClass}">ì ìˆ˜: ${rec.personalizedScore}/10</span>
                            </div>
                            <div class="card-body">
                                <h6><strong>ğŸ—ºï¸ ${rec.destination}</strong></h6>
                                <p>${rec.description}</p>
                                
                                <div class="alert alert-info">
                                    <strong>ğŸ’¡ ${data.mbti} ë§ì¶¤ ì´ìœ :</strong><br>
                                    ${rec.mbtiAlignment}<br><br>
                                    <strong>ì¶”ì²œ ê·¼ê±°:</strong><br>
                                    ${rec.reasonWhy}
                                </div>
                                
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>ğŸ¯ ì¶”ì²œ í™œë™:</strong></p>
                                        <ul>
                                            ${rec.recommendedActivities.map(activity => `<li>${activity}</li>`).join('')}
                                        </ul>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>â° ìµœì  ì‹œê¸°:</strong> ${rec.bestTiming}</p>
                                        <p><strong>ğŸ’° ì˜ˆìƒ ë¹„ìš©:</strong> ${rec.budgetRange}</p>
                                        <p><strong>ğŸ“… ì¶”ì²œ ê¸°ê°„:</strong> ${rec.travelDuration}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }

            // ê°œì¸í™” ì¸ì‚¬ì´íŠ¸ í‘œì‹œ
            if (recommendations.personalizedInsights) {
                const insights = recommendations.personalizedInsights;
                html += `
                    <div class="card">
                        <div class="card-header">
                            <h5>ğŸ¯ ${data.mbti} ì—¬í–‰ ì¸ì‚¬ì´íŠ¸</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>âœ… ì—¬í–‰ ì‹œ ê°•ì </h6>
                                    <ul>
                                        ${insights.strengthsForTravel.map(strength => `<li>${strength}</li>`).join('')}
                                    </ul>
                                    
                                    <h6>ğŸ¤ ì´ìƒì ì¸ ë™í–‰ì</h6>
                                    <p>${insights.idealTravelCompanion}</p>
                                </div>
                                <div class="col-md-6">
                                    <h6>âš ï¸ ê³ ë ¤ì‚¬í•­</h6>
                                    <ul>
                                        ${insights.thingsToConsider.map(item => `<li>${item}</li>`).join('')}
                                    </ul>
                                    
                                    <h6>âŒ í”¼í•´ì•¼ í•  ì—¬í–‰</h6>
                                    <ul>
                                        ${insights.avoidRecommendations.map(avoid => `<li>${avoid}</li>`).join('')}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            resultsDiv.innerHTML = html;
        }

        // ê³„ì ˆë³„ ì˜ˆì¸¡ ë¶„ì„ ì‹¤í–‰
        async function getSeasonalPrediction() {
            const monthSelect = document.getElementById('predictionMonthSelect').value;
            
            const loadingIndicator = document.getElementById('seasonalLoadingIndicator');
            const resultsDiv = document.getElementById('seasonalResults');
            const chartContainer = document.getElementById('seasonalChartContainer');
            
            loadingIndicator.style.display = 'block';
            chartContainer.style.display = 'none';
            resultsDiv.innerHTML = '<div class="alert alert-info">ğŸŒ¤ï¸ ê³„ì ˆë³„ íŠ¸ë Œë“œë¥¼ ì˜ˆì¸¡ ì¤‘ì…ë‹ˆë‹¤...</div>';

            try {
                let endpoint = '/api/seasonal-prediction/current-month';
                let body = {};
                
                if (monthSelect !== 'current') {
                    endpoint = `/api/seasonal-prediction/month/${monthSelect}`;
                }

                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(body)
                });

                const data = await response.json();
                
                loadingIndicator.style.display = 'none';
                
                if (data.status === 'success') {
                    displaySeasonalPrediction(data);
                    createSeasonalChart(data.prediction);
                    chartContainer.style.display = 'block';
                    
                    if (window.mobileUtils) {
                        window.mobileUtils.showToast('ğŸŒ¤ï¸ ê³„ì ˆë³„ ì˜ˆì¸¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!', 'success', 4000);
                    }
                } else {
                    resultsDiv.innerHTML = `<div class="alert alert-danger">${data.message}</div>`;
                }
                
            } catch (error) {
                loadingIndicator.style.display = 'none';
                resultsDiv.innerHTML = '<div class="alert alert-danger">ê³„ì ˆë³„ ì˜ˆì¸¡ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
                console.error('Error:', error);
            }
        }

        // ê³„ì ˆë³„ ì˜ˆì¸¡ ê²°ê³¼ í‘œì‹œ
        function displaySeasonalPrediction(data) {
            const resultsDiv = document.getElementById('seasonalResults');
            const prediction = data.prediction;
            
            let html = `
                <div class="alert alert-success">
                    <strong>ğŸŒ¤ï¸ ${data.monthName} íŠ¸ë Œë“œ ì˜ˆì¸¡ ì™„ë£Œ</strong>
                    <div class="mt-2">ë¶„ì„ ì‹œê°„: ${new Date().toLocaleString()}</div>
                </div>
            `;

            // ìƒìŠ¹ ì˜ˆì¸¡ ì—¬í–‰ì§€ í‘œì‹œ
            if (prediction.risingDestinations) {
                html += '<h4>ğŸ“ˆ ìƒìŠ¹ ì˜ˆì¸¡ ì—¬í–‰ì§€ TOP 5</h4>';
                
                prediction.risingDestinations.forEach((dest, index) => {
                    const rankIcon = index < 3 ? ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'][index] : `${index + 1}ìœ„`;
                    const progressWidth = (dest.predictedScore / 10) * 100;
                    
                    html += `
                        <div class="card mb-3">
                            <div class="card-body">
                                <div class="d-flex justify-content-between align-items-start">
                                    <div style="flex: 1;">
                                        <h6>${rankIcon} <strong>${dest.destinationName}</strong></h6>
                                        <p class="mb-2">${dest.risingReason}</p>
                                        
                                        <div class="row">
                                            <div class="col-md-6">
                                                <small><strong>í˜„ì¬ ì ìˆ˜:</strong> ${dest.currentScore}/10</small><br>
                                                <small><strong>ì˜ˆì¸¡ ì ìˆ˜:</strong> ${dest.predictedScore}/10</small><br>
                                                <small><strong>ì„±ì¥ë¥ :</strong> <span class="badge badge-success">${dest.growthRate}</span></small>
                                            </div>
                                            <div class="col-md-6">
                                                <small><strong>ìµœì  ì‹œê¸°:</strong> ${dest.bestTiming}</small><br>
                                                <small><strong>íŠ¹ì§•:</strong> ${dest.specialFeatures.join(', ')}</small>
                                            </div>
                                        </div>
                                        
                                        <div class="mt-2">
                                            <div class="progress" style="height: 6px;">
                                                <div class="progress-bar bg-success" style="width: ${progressWidth}%"></div>
                                            </div>
                                        </div>
                                        
                                        <div class="mt-2">
                                            <strong>ì¶”ì²œ í™œë™:</strong>
                                            ${dest.recommendedActivities.map(activity => `<span class="badge badge-outline-primary mr-1">${activity}</span>`).join('')}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                });
            }

            // ê³„ì ˆ ì¸ì‚¬ì´íŠ¸ í‘œì‹œ
            if (prediction.seasonalInsights) {
                const insights = prediction.seasonalInsights;
                html += `
                    <div class="card">
                        <div class="card-header">
                            <h5>ğŸ” ${data.monthName} ì—¬í–‰ ì¸ì‚¬ì´íŠ¸</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <h6>â˜€ï¸ ë‚ ì”¨ ì¥ì </h6>
                                    <p>${insights.weatherAdvantage}</p>
                                    
                                    <h6>ğŸ¯ ì¸ê¸° ì•¡í‹°ë¹„í‹°</h6>
                                    <ul>
                                        ${insights.popularActivities.map(activity => `<li>${activity}</li>`).join('')}
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <h6>âš ï¸ ì£¼ì˜ì‚¬í•­</h6>
                                    <ul>
                                        ${insights.avoidanceFactors.map(factor => `<li>${factor}</li>`).join('')}
                                    </ul>
                                    
                                    <div class="mt-3">
                                        <p><strong>ğŸ’° ì˜ˆì‚° íŠ¸ë Œë“œ:</strong> 
                                            <span class="badge ${insights.budgetTrend === 'high' ? 'badge-danger' : insights.budgetTrend === 'medium' ? 'badge-warning' : 'badge-success'}">
                                                ${insights.budgetTrend === 'high' ? 'ë†’ìŒ' : insights.budgetTrend === 'medium' ? 'ë³´í†µ' : 'ë‚®ìŒ'}
                                            </span>
                                        </p>
                                        <p><strong>ğŸ‘¥ í˜¼ì¡ë„:</strong> 
                                            <span class="badge ${insights.crowdLevel === 'high' ? 'badge-danger' : insights.crowdLevel === 'medium' ? 'badge-warning' : 'badge-success'}">
                                                ${insights.crowdLevel === 'high' ? 'ë†’ìŒ' : insights.crowdLevel === 'medium' ? 'ë³´í†µ' : 'ë‚®ìŒ'}
                                            </span>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }

            resultsDiv.innerHTML = html;
        }

        // ê³„ì ˆë³„ ì˜ˆì¸¡ ì°¨íŠ¸ ìƒì„±
        function createSeasonalChart(prediction) {
            const ctx = document.getElementById('seasonalChart').getContext('2d');
            
            if (window.seasonalChart) {
                window.seasonalChart.destroy();
            }

            const destinations = prediction.risingDestinations || [];
            const labels = destinations.map(dest => dest.destinationName);
            const currentScores = destinations.map(dest => dest.currentScore);
            const predictedScores = destinations.map(dest => dest.predictedScore);

            window.seasonalChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'í˜„ì¬ ì ìˆ˜',
                        data: currentScores,
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }, {
                        label: 'ì˜ˆì¸¡ ì ìˆ˜',
                        data: predictedScores,
                        backgroundColor: 'rgba(75, 192, 192, 0.6)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10,
                            title: {
                                display: true,
                                text: 'íŠ¸ë Œë“œ ì ìˆ˜'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'ì—¬í–‰ì§€'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'ê³„ì ˆë³„ ì—¬í–‰ì§€ íŠ¸ë Œë“œ ì˜ˆì¸¡'
                        },
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    }
                }
            });
        }
    </script>

    <!-- MBTI ë§ì¶¤ ì¶”ì²œ ì„¹ì…˜ -->
    <section id="mbti-recommendations" class="container" style="display: none;">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ğŸ¯ MBTI ë§ì¶¤ ì¶”ì²œ</h2>
                <p>ì„±ê²© ìœ í˜•ë³„ ë² ìŠ¤íŠ¸ 3 ì—¬í–‰ íŠ¸ë Œë“œë¥¼ ì¶”ì²œë°›ìœ¼ì„¸ìš”</p>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label class="form-label">MBTI ì„ íƒ *</label>
                            <select id="mbtiSelectForRecommendation" class="form-control" required>
                                <option value="">MBTIë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                                <option value="INTJ">INTJ - ê±´ì¶•ê°€</option>
                                <option value="INTP">INTP - ë…¼ë¦¬ìˆ ì‚¬</option>
                                <option value="ENTJ">ENTJ - í†µì†”ì</option>
                                <option value="ENTP">ENTP - ë³€ë¡ ê°€</option>
                                <option value="INFJ">INFJ - ì˜¹í˜¸ì</option>
                                <option value="INFP">INFP - ì¤‘ì¬ì</option>
                                <option value="ENFJ">ENFJ - ì„ ë„ì</option>
                                <option value="ENFP">ENFP - í™œë™ê°€</option>
                                <option value="ISTJ">ISTJ - ê´€ë¦¬ì</option>
                                <option value="ISFJ">ISFJ - ìˆ˜í˜¸ì</option>
                                <option value="ESTJ">ESTJ - ì‚¬ì—…ê°€</option>
                                <option value="ESFJ">ESFJ - ì§‘ì •ê´€</option>
                                <option value="ISTP">ISTP - ì œì‘ì</option>
                                <option value="ISFP">ISFP - ëª¨í—˜ê°€</option>
                                <option value="ESTP">ESTP - ì‚¬ì—…ê°€</option>
                                <option value="ESFP">ESFP - ì—°ì˜ˆì¸</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ì—¬í–‰ ì‹œê¸°</label>
                            <select id="seasonSelect" class="form-control">
                                <option value="í˜„ì¬">í˜„ì¬ (8ì›”)</option>
                                <option value="ê°€ì„">ê°€ì„</option>
                                <option value="ê²¨ìš¸">ê²¨ìš¸</option>
                                <option value="ë´„">ë´„</option>
                                <option value="ì—¬ë¦„">ì—¬ë¦„</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ì˜ˆì‚° ìˆ˜ì¤€</label>
                            <select id="budgetSelect" class="form-control">
                                <option value="ê²½ì œì ">ê²½ì œì  (10-30ë§Œì›)</option>
                                <option value="ì¤‘ê°„" selected>ì¤‘ê°„ (30-70ë§Œì›)</option>
                                <option value="ì—¬ìœ ë¡œìš´">ì—¬ìœ ë¡œìš´ (70ë§Œì› ì´ìƒ)</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">ê´€ì‹¬ì‚¬ (ë³µìˆ˜ ì„ íƒ ê°€ëŠ¥)</label>
                            <div class="interests-container" style="display: flex; flex-direction: column; gap: 8px;">
                                <label style="display: flex; align-items: center;"><input type="checkbox" name="interests" value="ë¬¸í™”ì²´í—˜" style="margin-right: 8px;"> ë¬¸í™”ì²´í—˜</label>
                                <label style="display: flex; align-items: center;"><input type="checkbox" name="interests" value="ìì—°ê²½ê´€" style="margin-right: 8px;"> ìì—°ê²½ê´€</label>
                                <label style="display: flex; align-items: center;"><input type="checkbox" name="interests" value="ëª¨í—˜í™œë™" style="margin-right: 8px;"> ëª¨í—˜í™œë™</label>
                                <label style="display: flex; align-items: center;"><input type="checkbox" name="interests" value="íœ´ì–‘íë§" style="margin-right: 8px;"> íœ´ì–‘íë§</label>
                                <label style="display: flex; align-items: center;"><input type="checkbox" name="interests" value="ë¯¸ì‹íƒë°©" style="margin-right: 8px;"> ë¯¸ì‹íƒë°©</label>
                                <label style="display: flex; align-items: center;"><input type="checkbox" name="interests" value="ì‡¼í•‘" style="margin-right: 8px;"> ì‡¼í•‘</label>
                            </div>
                        </div>
                        
                        <button onclick="getMbtiRecommendations()" class="btn btn-primary btn-block">MBTI ë§ì¶¤ ì¶”ì²œ ë°›ê¸°</button>
                    </div>
                    
                    <div class="col-md-6">
                        <div id="mbtiLoadingIndicator" class="loading-spinner" style="display: none;"></div>
                        <div id="mbtiResults"></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ê³„ì ˆë³„ íŠ¸ë Œë“œ ì˜ˆì¸¡ ì„¹ì…˜ -->
    <section id="seasonal-prediction" class="container" style="display: none;">
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">ğŸŒ¤ï¸ ê³„ì ˆë³„ íŠ¸ë Œë“œ ì˜ˆì¸¡</h2>
                <p>8ì›” í˜„ì¬ ìƒìŠ¹ ì˜ˆì¸¡ ì—¬í–‰ì§€ë¥¼ í™•ì¸í•˜ì„¸ìš”</p>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label class="form-label">ì˜ˆì¸¡ ì›” ì„ íƒ</label>
                            <select id="predictionMonthSelect" class="form-control">
                                <option value="current" selected>í˜„ì¬ ì›” (8ì›”)</option>
                                <option value="9">9ì›”</option>
                                <option value="10">10ì›”</option>
                                <option value="11">11ì›”</option>
                                <option value="12">12ì›”</option>
                            </select>
                        </div>
                        <button onclick="getSeasonalPrediction()" class="btn btn-success btn-block">ê³„ì ˆ ì˜ˆì¸¡ ë¶„ì„</button>
                    </div>
                    
                    <div class="col-md-8">
                        <div id="seasonalLoadingIndicator" class="loading-spinner" style="display: none;"></div>
                        <div id="seasonalResults"></div>
                    </div>
                </div>
                
                <div class="row mt-4">
                    <div class="col-12">
                        <div class="chart-container" id="seasonalChartContainer" style="display: none;">
                            <canvas id="seasonalChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

</body>
</html>